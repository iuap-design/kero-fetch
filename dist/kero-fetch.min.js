!function(){"use strict";function _updateDom(e,t){for(var r in t){var a=t[r];for(var e in a){var s=a[e];if("trigger"==e)trigger(e,s[0]);else if(u.isArray(s))each(s,function(t,r){e[t](r)});else try{e[r](a)}catch(t){e[r](a[r])}}}}var isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},each=function(e,t){if(e.forEach)e.forEach(function(e,r){t(r,e)});else{if(!(e instanceof Object))return;for(var r in e)t(r,e[r])}};try{NodeList.prototype.forEach=Array.prototype.forEach}catch(e){}String.prototype.lengthb=function(){return this.replace(/[^\x00-\xff]/g,"**").length},String.prototype.replaceAll=function(e,t){var r=new RegExp(e,"g");return this.replace(r,t)};var addDataTable=function(e,t){var r=this.app.getDataTable(e);return this.datas[e]=r.getDataByRule(t),this},addDataTables=function(e,t){if(2==arguments.length)for(var r=0;r<e.length;r++){var t;"string"==typeof arguments[1]?t=arguments[1]:isArray(arguments[1])&&(t=arguments[1][r]),this.addDataTable(e[r],t)}else for(var r=0;r<e.length;r++){var a=e[r];if("string"==typeof a)this.addDataTable(a);else for(var s in a)this.addDataTable(s,a[s])}return this},addAllDataTables=function(e){for(var t=this.app.dataTables,r=0;r<t.length;r++)this.addDataTable(t[r].id,e)},updateDataTables=function(e){for(var t in e){var r=this.app.getDataTable(t);r&&(r.setData(e[t]),r.updateMeta(e[t].meta))}},enumerables=!0,enumerablesTest={toString:1};for(var i in enumerablesTest)enumerables=null;enumerables&&(enumerables=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"]);var extend=function(e,t){var r,a=arguments;if(a.length>1)for(var s=1;s<a.length;s++)if(r=a[s],e&&r&&"object"==typeof r){var n,i,o;for(n in r)e[n]=r[n];if(enumerables)for(i=enumerables.length;i--;)o=enumerables[i],r.hasOwnProperty&&r.hasOwnProperty(o)&&(e[o]=r[o])}return e};Object.assign||(Object.assign=extend);var u$1={};extend(u$1,{isIE:!1,isFF:!1,isOpera:!1,isChrome:!1,isSafari:!1,isWebkit:!1,isIE8_BEFORE:!1,isIE8:!1,isIE8_CORE:!1,isIE9:!1,isIE9_CORE:!1,isIE10:!1,isIE10_ABOVE:!1,isIE11:!1,isEdge:!1,isIOS:!1,isIphone:!1,isIPAD:!1,isStandard:!1,version:0,isWin:!1,isUnix:!1,isLinux:!1,isAndroid:!1,isAndroidPAD:!1,isAndroidPhone:!1,isMac:!1,hasTouch:!1,isMobile:!1}),function(){var e=navigator.userAgent,t=/(msie\s|trident.*rv:)([\w.]+)/,r=/(firefox)\/([\w.]+)/,a=/(opera).+version\/([\w.]+)/,s=/(chrome)\/([\w.]+)/,n=/version\/([\w.]+).*(safari)/,i=e.toLowerCase(),o={browser:"",version:""},u=t.exec(i);if(null!=u&&(o={browser:"IE",version:u[2]||"0"}),u=r.exec(i),null!=u&&(o={browser:u[1]||"",version:u[2]||"0"}),u=a.exec(i),null!=u&&(o={browser:u[1]||"",version:u[2]||"0"}),u=s.exec(i),null!=u&&(o={browser:u[1]||"",version:u[2]||"0"}),u=n.exec(i),null!=u&&(o={browser:u[2]||"",version:u[1]||"0"}),e.indexOf("Edge")>-1&&(u$1.isEdge=!0),i.match(/opera.([\d.]+)/)?u$1.isOpera=!0:"IE"==o.browser&&11==o.version?(u$1.isIE11=!0,u$1.isIE=!0):i.match(/chrome\/([\d.]+)/)?(u$1.isChrome=!0,u$1.isStandard=!0):i.match(/version\/([\d.]+).*safari/)?(u$1.isSafari=!0,u$1.isStandard=!0):i.match(/gecko/)?(u$1.isFF=!0,u$1.isStandard=!0):i.match(/msie ([\d.]+)/)?u$1.isIE=!0:i.match(/firefox\/([\d.]+)/)&&(u$1.isFF=!0,u$1.isStandard=!0),i.match(/webkit\/([\d.]+)/)&&(u$1.isWebkit=!0),i.match(/ipad/i)&&(u$1.isIOS=!0,u$1.isIPAD=!0,u$1.isStandard=!0),i.match(/iphone/i)&&(u$1.isIOS=!0,u$1.isIphone=!0),"Mac68K"!=navigator.platform&&"MacPPC"!=navigator.platform&&"Macintosh"!=navigator.platform&&"MacIntel"!=navigator.platform||(u$1.isMac=!0),"Win32"!=navigator.platform&&"Windows"!=navigator.platform&&"Win64"!=navigator.platform||(u$1.isWin=!0),"X11"!=navigator.platform||u$1.isWin||u$1.isMac||(u$1.isUnix=!0),String(navigator.platform).indexOf("Linux")>-1&&(u$1.isLinux=!0),(i.indexOf("Android")>-1||i.indexOf("android")>-1||i.indexOf("Adr")>-1||i.indexOf("adr")>-1)&&(u$1.isAndroid=!0),u$1.version=0,u$1.isAndroid&&(window.screen.width>=768&&window.screen.width<1024&&(u$1.isAndroidPAD=!0),window.screen.width<=768&&(u$1.isAndroidPhone=!0)),u$1.isIE){var c=parseInt(u$1.version),l=document.documentMode;null==l?6!=c&&7!=c||(u$1.isIE8_BEFORE=!0):(7==l?u$1.isIE8_BEFORE=!0:8==l?u$1.isIE8=!0:9==l?(u$1.isIE9=!0,u$1.isSTANDARD=!0):10==l?(u$1.isIE10=!0,u$1.isSTANDARD=!0,u$1.isIE10_ABOVE=!0):u$1.isSTANDARD=!0,8==c?u$1.isIE8_CORE=!0:9==c?u$1.isIE9_CORE=!0:11==o.version&&(u$1.isIE11=!0))}"ontouchend"in document&&(u$1.hasTouch=!0),(u$1.isIphone||u$1.isAndroidPhone)&&(u$1.isMobile=!0)}();var env=u$1,XmlHttp={get:"get",post:"post",reqCount:4,createXhr:function(){var e=null;return env.isIE8?e=new ActiveXObject("Microsoft.XMLHTTP"):env.isIE?e=new ActiveXObject("Msxml2.XMLHTTP"):window.XMLHttpRequest&&(e=new XMLHttpRequest),e},ajax:function(e){var t=e.url,r=e.success,a=void 0==e.async||e.async,s=e.error,n=e.data||{},i=(void 0==e.type?XmlHttp.post:e.type).toLowerCase();n.compressType;t=XmlHttp.serializeUrl(t),n=XmlHttp.serializeParams(n),i==XmlHttp.get&&null!=n&&(t+="&"+n,n=null);var o=XmlHttp.createXhr();o.open(i,t,a),i==XmlHttp.post&&o.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");var u=0;a?(o.onreadystatechange=function(){u++,o.readyState==XmlHttp.reqCount&&XmlHttp.execBack(o,r,s)},o.send(n)):(o.send(n),XmlHttp.execBack(o,r,s))},execBack:function(e,t,r){if(200==e.status||304==e.status||4==e.readyState)t(e.responseText,e.status,e);else if(r)r(e.responseText,e.status,e);else{var a="no error callback function!";e.responseText&&(a=e.responseText),alert(a)}},serializeUrl:function(e){var t="cache="+Math.random();return e.indexOf("?")>0?e+="&"+t:e+="?"+t,e},serializeParams:function(e){if(void 0==e||null==e||""==e)return null;if(e.constructor==Object){var t="";for(var r in e)t+=r+"="+encodeURIComponent(e[r])+"&";return t.substring(0,t.length-1)}return e}},ajax=XmlHttp.ajax,fire=function(e){var t=this,r=this.getData();r.parameters=ko.utils.stringifyJson(this.params);var a={type:e.type||"POST",data:e.params||{},url:e.url||ServerEvent.DEFAULT.url,async:void 0===e.async?ServerEvent.DEFAULT.async:e.async,singleton:e.singleton||ServerEvent.DEFAULT.singleton,success:e.success,error:e.error,dataType:"json"};a.data.ctrl=e.ctrl,a.data.method=e.method,this.event&&(a.data.event=ko.utils.stringifyJson(this.event));var s=e.preSuccess||function(){},n=e.success||function(){},i=a.error;this.orignError=i;var o=a.deferred;o&&o.resolve||(o={resolve:function(){},reject:function(){}}),a.success=function(e,r,a){"string"==typeof e&&(e=JSON.parse(e)),t.processXHRError(t,e,r,a)?(s.call(null,e),t._successFunc(e,o),n.call(null,e.custom),o.resolve()):o.reject()},a.error=function(e,r,a){"string"==typeof e&&(e=JSON.parse(e)),t.processXHRError(t,e,r,a)?i&&i.call(null,e.custom):o.reject()},a.data=extend(a.data,r),$?$.ajax(a):ajax(a)},_successFunc=function(e,t){"string"==typeof e&&(e=JSON.parse(e));var r=e.dataTables,a=e.dom;a&&this.updateDom(JSON.parse(a)),r&&this.updateDataTables(r,t)},setSuccessFunc=function(e){this._successFunc=e},processXHRError=function processXHRError(self,rsl,state,xhr){return"string"==typeof rsl&&(rsl=JSON.parse(rsl)),!xhr.getResponseHeader||!xhr.getResponseHeader("X-Error")||(self.orignError?self.orignError.call(self,rsl,state,xhr):(u.showMessageDialog?u.showMessageDialog({type:"info",title:"提示",msg:rsl.message,backdrop:!0}):alert(rsl.message),rsl.operate&&eval(rsl.operate)),!1)},trigger=function(e,t){e.uEvent&&e.uEvent[t]&&e.uEvent[t+"fn"]()},setCompression=function(e){env.isIE8||window.pako||1!=e?this.compression=e:alert("can't compression, please include  pako!")},addParameter=function(e,t){return this.params[e]=t,this},setEvent=function(e){return this.event=_formatEvent(e),this},_formatEvent=function(e){return e},getData=function(){var e=ko.utils.stringifyJson(this.app.getEnvironment()),t=ko.utils.stringifyJson(this.datas,function(e,t){return void 0===t||null==t?"":t}),r="",a=!1;return window.trimServerEventData&&(t=window.trimServerEventData(t)),this.compression&&!env.isIE8&&window.pako&&(e=encodeBase64(window.pako.gzip(e)),t=encodeBase64(window.pako.gzip(t)),a=!0,r="gzip"),{environment:e,dataTables:t,compression:a,compressType:r}},updateDom=function(){each(dom,function(e,t){var r=t.two;_updateDom(t.one,r)})},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ServerEvent$1=function e(t){classCallCheck(this,e),this.app=t,this.datas={},this.params={},this.event=null,this.ent=u.core.collectEnvironment(),u.debugMode||(this.compression=!0)};ServerEvent$1.prototype.addDataTable=addDataTable,ServerEvent$1.prototype.addDataTables=addDataTables,ServerEvent$1.prototype.addAllDataTables=addAllDataTables,ServerEvent$1.prototype.updateDataTables=updateDataTables,ServerEvent$1.prototype.fire=fire,ServerEvent$1.prototype.setSuccessFunc=setSuccessFunc,ServerEvent$1.prototype._successFunc=_successFunc,ServerEvent$1.prototype.processXHRError=processXHRError,ServerEvent$1.prototype.setCompression=setCompression,ServerEvent$1.prototype.addParameter=addParameter,ServerEvent$1.prototype.setEvent=setEvent,ServerEvent$1.prototype.getData=getData,ServerEvent$1.prototype.updateDom=updateDom,ServerEvent$1.DEFAULT={async:!0,singleton:!0,url:(window.$ctx||"/iwebap")+"/evt/dispatch"},window.ServerEvent=ServerEvent$1}();
